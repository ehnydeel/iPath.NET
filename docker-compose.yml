version: "3.9"

services:
  ipath_server:
    build:
      context: .
      dockerfile: src/ui/iPath.Blazor.Server/Dockerfile
    image: ipath/ipath_server:latest
    ports:
      - "5001:5000" # Host port 5001 -> container 5000
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - CONFIG_PATH=/opt/ipath/config
      - ConnectionStrings__Postgres=Host=db;Port=5432;Database=ipath;Username=ipathuser;Password=ChangeMe!
    depends_on:
      - db
    # Persistent host-accessible folder mounted into container at /opt/ipath
    # This uses a bind mount so the data is directly accessible from the host (./ipath_data).
    volumes:
      - C:/Daten/ipath_podman:/opt/ipath:rw

  db:
    image: postgres:15-alpine
    restart: unless-stopped
    environment:
      - POSTGRES_DB=ipath
      - POSTGRES_USER=ipathuser
      - POSTGRES_PASSWORD=ChangeMe!
    volumes:
      - pgdata:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  pgdata: