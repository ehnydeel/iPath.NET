@namespace iPath.Blazor.Componenents.ServiceRequests
@inject ServiceRequestViewModel vm

<MudExpansionPanels>
    <MudExpansionPanel ExpandedChanged="OnExpanded">
        <TitleContent >
            <strong>@QName (@T["automatically generated text"])</strong>
            <div>@Model.Questionnaire.GeneratedText</div>
        </TitleContent>
        <ChildContent>
            <QuestionnaireResponseView Data="Model.Questionnaire" @ref="qv"/>
        </ChildContent>
    </MudExpansionPanel>
</MudExpansionPanels>

@code {
    [Parameter]
    public RequestDescription Model { get; set; }

    string? QName;
    QuestionnaireResponseView qv;

    protected override async Task OnInitializedAsync()
    {
        QName = await @vm.QuestionnaireName(Model?.Questionnaire?.QuestionnaireId, Model?.Questionnaire?.Version);
        QName ??= "generated text";
    }

    private async Task OnExpanded(bool args)
    {
        await qv.LoadDataAsync();
    }
}
