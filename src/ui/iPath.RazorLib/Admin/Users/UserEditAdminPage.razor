@page "/admin/users/{id}"
@page "/admin/users/{id}/{panel}"

@inject IStringLocalizer T
@inject UserAdminViewModel vm

@attribute [Authorize(Roles = "Admin")]

<MudText Typo="Typo.h5">@T["Edit User:"] @vm.SelectedUser?.Username</MudText>

<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" Class="mt-2"
         PanelClass="pa-6" Color="Color.Info" IconColor="Color.Surface"
         @bind-ActivePanelIndex="panelIndex">
    <MudTabPanel Text=@T["Profile"] Icon="@Icons.Material.Filled.Settings">
        <UserProfileAdmin User="@vm.SelectedUser" />
    </MudTabPanel>
    <MudTabPanel Text=@T["Communities"] Icon="@Icons.Material.Filled.Person">
        <UserCommunityMembershipGrid User="@vm.SelectedUser" />
    </MudTabPanel>
    <MudTabPanel Text=@T["Groups"] Icon="@Icons.Material.Filled.Groups">
        <UserGroupMembershipGrid User="@vm.SelectedUser" />
    </MudTabPanel>
    <MudTabPanel Text=@T["Notifications"] Icon="@Icons.Material.Filled.Person">
        <UserNotificationGrid User="@vm.SelectedUser" />
    </MudTabPanel>
</MudTabs>


@inject NavigationManager nm

@code {
    [Parameter]
    public string id { get; set; }

    [Parameter]
    public string panel { get; set; } = "";

    int panelIndex = 0;

    protected override async Task OnParametersSetAsync()
    {
        if (Guid.TryParse(id, out var userid))
        {
            await vm.LoadUser(userid);
            if (vm.SelectedUser is null)
            {
                nm.NavigateTo("admin/users");
                return;
            };
            StateHasChanged();
        }


        panelIndex = panel switch
        {
            "communities" => 1,
            "groups" => 2,
            "notifications" => 3,
            _ => 0
        };
    }
}
