@page "/admin/communities/{id}"
@using iPath.Application.Features.ServiceRequests
@using iPath.Blazor.Componenents.Admin.Community

@inject CommunityAdminViewModel vm
@inject IStringLocalizer T

@attribute [Authorize(Roles = "Admin")]

<MudBreadcrumbs Items="vm.BreadCrumbs" Class="mt-0 pt-0"></MudBreadcrumbs>

@if (vm.SelectedCommunity is null)
{
    <IPathHeader Title=@T["Community Administration"] />
}
else
{

    <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true"
             TabPanelsClass="pa-6"
             Color="Color.Info" IconColor="Color.Surface"
             @bind-ActivePanelIndex="panelIndex">
        <MudTabPanel Text=@T["Settings"] Icon="@Icons.Material.Filled.Settings" >
            <CommunityAdminSettings Model="@vm.SelectedCommunity" />
        </MudTabPanel>
        <MudTabPanel Text=@T["Members"] Icon="@Icons.Material.Filled.Person">
            <CommunityAdminMembersTable Model="@vm.SelectedCommunity" />
        </MudTabPanel>
        <MudTabPanel Text=@T["Groups"] Icon="@Icons.Material.Filled.Groups">
            <CommunityAdminGroups Model="@vm.SelectedCommunity" />
        </MudTabPanel>
        <MudTabPanel Text=@T["Questionnaires"] Icon="@Icons.Material.Filled.DynamicForm">
            <CommunityAdminQuestionnaires Model="@vm.SelectedCommunity" />
        </MudTabPanel>
    </MudTabs>
}


@code {
    [Parameter]
    public string id { get; set; }

    int panelIndex = 0;

    CommunityDto Model { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
        if (Guid.TryParse(id, out var cid))
        {
            await vm.LoadCommunity(cid);
        }
    }
}