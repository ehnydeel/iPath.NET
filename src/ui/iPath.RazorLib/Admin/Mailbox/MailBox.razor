@page "/admin/mailbox"

@inject MailBoxViewModel vm
@inject IStringLocalizer T

<IPathHeader Title=@T["Mailbox"]>
    <ActionContent>
        <MudFab StartIcon="@Icons.Material.TwoTone.Refresh"
                Size="Size.Small" IconSize="Size.Small"
                OnClick=@(() => vm.grid.ReloadServerData()) />
        <MudFab StartIcon="@Icons.Material.TwoTone.DeleteForever"
                Size="Size.Small" IconSize="Size.Small"
                OnClick="vm.DeleteAll" />
        <MudFab StartIcon="@Icons.Material.TwoTone.Create"
                Size="Size.Small" IconSize="Size.Small"
                OnClick="vm.SendMail" />
    </ActionContent>
</IPathHeader>

<MudDataGrid T="EmailMessage" ServerData="vm.GetData" @ref="vm.grid"
             Hover="true" Dense="true"
             HierarchyVisibilityToggled="vm.OnDetailsOpened">
    <ColGroup>
        <col style="width: 30px;" />
        <col style="width: 30%;" />
        <col style="width: 70%;" />
        <col style="width: 100px;" />
        <col style="width: 40px;" />
    </ColGroup>
    <Columns>
        <HierarchyColumn T="EmailMessage" />
        <PropertyColumn Property="e => e.Receiver" Title=@T["Reveiver"] />
        <PropertyColumn Property="e => e.Subject" Title=@T["Subject"] />
        <PropertyColumn Property="e => e.CreatedOn" Format="d" Title=@T["Date"] />
        <TemplateColumn>
            <CellTemplate>
                <MudIcon Icon=@context.Item.ReadIcon Size="Size.Small" />
            </CellTemplate>
        </TemplateColumn>
        <TemplateColumn>
            <CellTemplate>
                <MudIconButton StartIcon="@Icons.Material.Filled.DeleteForever"
                               Size="Size.Small" OnClick=@(() => vm.Delete(context.Item)) />
            </CellTemplate>
        </TemplateColumn>
    </Columns>
    <ChildRowContent>
        @((MarkupString)context.Item.Body)
    </ChildRowContent>
    <PagerContent>
        <MudDataGridPager T="EmailMessage" />
    </PagerContent>
</MudDataGrid>
