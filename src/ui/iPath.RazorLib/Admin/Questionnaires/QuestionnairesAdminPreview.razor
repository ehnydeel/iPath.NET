@page "/admin/questionnaires/{id}"

@inject IStringLocalizer T
@inject QuestionnaireAdminViewModel vm

@attribute [Authorize(Roles = "Admin")]

@inject QuestionnaireAdminViewModel vm


<MudBreadcrumbs Items="vm.BreadCrumbs" Class="mt-0 pt-0"></MudBreadcrumbs>

@if (vm.SelectedQuestionnaire is not null)
{
    <IPathHeader Title=@($"{vm.SelectedQuestionnaire.Name}, Version={vm.SelectedQuestionnaire.Version}")>
        <ActionContent>
            <MudFab StartIcon="@Icons.Material.Filled.Backspace" Href="admin/questionnaires" Size="Size.Small" />
        </ActionContent>
    </IPathHeader>
    <iPath.LHCForms.LhcForm @ref="vm.preview" ReadOnly="false" />
}

@code {
    [Parameter]
    public string id { get; set; }

    QuestionnaireEntity q;


    protected override async Task OnParametersSetAsync()
    {
        if (Guid.TryParse(id, out var guid))
        {
            await vm.Load(guid);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && vm.SelectedQuestionnaire is not null)
        {
            await vm.preview.LoadFormAsync(vm.SelectedQuestionnaire.Resource, "");
        }
    }
}