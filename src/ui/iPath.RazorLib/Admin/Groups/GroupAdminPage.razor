@page "/admin/groups"

@attribute [Authorize(Roles = "Admin")]

<MudGrid Spacing="2">
    <MudItem xs="12" sm="8" md="7">
        <IPathHeader Typo="Typo.h5" Title="Group Administration">
            <ActionContent>
                <MudTooltip Text=@T["create a new group"]>
                    <MudFab StartIcon="@Icons.Material.Filled.Add" Size="Size.Small" OnClick="vm.Create" />
                </MudTooltip>
            </ActionContent>
        </IPathHeader>
        <MudDataGrid T="GroupListDto" ServerData="vm.GetListAsync" @ref="vm.grid"
                     RowClick="@(async args => await vm.SetSelectedItem(args.Item))"
                     RowStyleFunc="vm.SelectedRowStyle"
                     Dense>
            <ToolBarContent>
                <MudText Typo="Typo.h6">Groups</MudText>
                <MudSpacer />
                <MudTextField @bind-Value="vm.SearchString" @bind-Value:after="@(() => vm.grid.ReloadServerData())"
                              Placeholder="Search" Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.Name" />
            </Columns>
            <PagerContent>
                <MudDataGridPager T="GroupListDto" PageSizeOptions="pageOpts" />
            </PagerContent>
        </MudDataGrid>
    </MudItem>
    <MudItem xs="12" sm="4" md="5">
        <IPathHeader Typo="Typo.h5" Title="@vm.SelectedGroup?.Name">
            <ActionContent>
                <MudTooltip Text=@T["edit this group"]>
                    <MudFab StartIcon="@Icons.Material.Filled.Edit" Size="Size.Small" OnClick="vm.Edit" />
                </MudTooltip>
                <MudTooltip Text=@T["questionnaires for group"]>
                    <MudFab StartIcon="@Icons.Material.Filled.DynamicForm" Size="Size.Small" OnClick="vm.EditQuestionnaires" />
                </MudTooltip>
            </ActionContent>
        </IPathHeader>

        <MudPaper Elevation="1" Style="min-height: 10em;" Class="pa-2">
            <GroupAdminDetailView Model="@vm.SelectedGroup" @ref="details" />
        </MudPaper>
    </MudItem>
</MudGrid>
