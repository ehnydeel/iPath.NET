@page "/node/new/{groupId}"
@page "/node/edit/{id}"

@inherits NodeViewComponentBase

<NodeHeader />
@if (vm.RootNode != null)
{
    <NodeEditForm Model="vm.RootNode.Description" Variant="Variant.Outlined" Class="my-8 z-50" />

    <NodeGalleryDropZone />

    <MudStack Row Spacing="4">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save"
                    OnClick="OnSave">@SaveText</MudButton>
        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Cancel"
                    OnClick=@(() => vm.CancelEdit())>Cancel</MudButton>
        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Delete">Delete</MudButton>
    </MudStack>
}

@code {
    [Parameter]
    public string groupId { get; set; }

    [Parameter]
    public string id { get; set; }

    string SaveText = "Save";
    string Title = "New Case";

    protected override async Task OnParametersSetAsync()
    {
        if (Guid.TryParse(groupId, out var GroupId))
        {
            await vm.CreateNewNode(GroupId);
            SaveText = T["Publish"];
            Title = T["New Case"];
        }
        else if (Guid.TryParse(id, out var nodeId))
        {
            await vm.LoadNode(nodeId);
            SaveText = T["Save"];
            Title = T["Edit Case"] + ": " + vm.RootNode.Title;
        }
        vm.IsEditing = true;
    }

    async Task OnSave()
    {
        await vm.Save();
    }
}
